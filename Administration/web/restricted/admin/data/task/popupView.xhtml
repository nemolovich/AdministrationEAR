<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://java.sun.com/jsf/facelets">
    <h:head>
        <title>Facelet Title</title>
    </h:head>
    <h:body>
        <f:view>
            <h:form id="taskViewForm">
                <p:outputPanel id="taskViewFormDetails"
                               rendered="#{not empty taskView.entityPopup}"
                               style="float:left;">
                    <p:outputPanel rendered="#{taskView.creating or taskView.editing}">
                        <p>
                            Veuillez renseigner les informations pour cette tâche.
                            <br />
                            (<span class="red-star">*</span>: champs requis)
                        </p>
                    </p:outputPanel>
                    <h:panelGrid columns="2" columnClasses="label,fields">

                        <h:outputLabel value="Description de l'intervention:" for="ptdescription"/>
                        <h:outputText id="ptdescriptionV" value="#{taskView.entityPopup.description}"
                                      title="Description"
                                      rendered="#{not taskView.creating and
                                                  not taskView.editing}"/>
                        <p:inputText id="ptdescription"
                                     maxlength="250"
                                     value="#{taskView.entityPopup.description}"
                                     title="Description de l'intervention"
                                     rendered="#{taskView.creating or
                                                 taskView.editing}">
                            <f:validator binding="#{notNullFieldValidator}"/>
                            <f:attribute name="requiredMessage"
                                         value="Veuillez entrer une description de l'intervention"/>
                            <f:attribute name="requiredTitle"
                                         value="Champs 'Description' vide"/>
                        </p:inputText>

                        <h:outputLabel value="Société:" for="ptidClient"/>
                        <p:outputPanel>
                            <h:outputText id="ptidClientV" value="#{taskView.entityPopup.idClient}"
                                          title="Société pour l'intervention"
                                          rendered="#{not taskView.creating and
                                                      not taskView.editing}"/>
                            <p:selectOneMenu id="ptidClient"
                                             value="#{taskView.entityPopup.idClient}"
                                             effect="fade"
                                             var="client"
                                             rendered="#{taskView.creating or
                                                         taskView.editing}">
                                <f:validator binding="#{notNullFieldValidator}"/>
                                <f:attribute name="requiredMessage"
                                             value="Veuillez sélectionner la société dans laquelle intervenir"/>
                                <f:attribute name="requiredTitle"
                                             value="Champs 'Société' invalide"/>
                                <f:selectItem itemLabel="Sélectionnez&nbsp;une&nbsp;société" itemValue=""/>
                                <f:selectItems value="#{clientView.entries}"/>
                                <f:converter binding="#{clientConverter}"/>
                                <p:ajax update="taskViewForm:ptidUser
                                        taskViewForm:ptidWorkstationFull
                                        taskViewForm:displayTclientDetails
                                        taskViewForm:tClientViewForm"
                                        process="@this"
                                        oncomplete="$('taskViewForm\\\\:displayTclientDetails').css('display','inline');"
                                        listener="#{taskView.ajaxSelect}"/>
                                
                                <p:column>
                                    #{client}
                                </p:column>
                            </p:selectOneMenu>
                            
                            <p:commandButton id="displayTclientDetails"
                                             actionListener="#{clientView.entityView(taskView.entityPopup.idClient)}"
                                             icon="ui-icon-search"
                                             update="taskViewForm:tclientDetails"
                                             style="font-size: 40%;vertical-align: top !important;margin-left: 10px;"
                                             oncomplete="displayBlock('taskViewForm\\:tclientDetails');"
                                             action="javascript:void(0);"
                                             title="Afficher les détails de la société"/>
                        </p:outputPanel>

                        <h:outputLabel value="Poste de travail:" for="ptidWorkstationFull"/>
                        <p:outputPanel style="white-space: nowrap;">
                            <h:inputTextarea id="ptidWorkstationFullV"
                                             value="#{taskView.entityPopup.idWorkstation.toString()}"
                                             readonly="true"
                                             styleClass="textarea_min"
                                             ondblclick="this.focus();this.select();"
                                            rendered="#{not taskView.creating and
                                                        not taskView.editing}">
                            </h:inputTextarea>
                            <p:selectOneMenu id="ptidWorkstationFull"
                                             value="#{taskView.entityPopup.idWorkstation}"
                                             effect="fade"
                                             style="width:90%;"
                                             var="poste"
                                             rendered="#{taskView.creating or
                                                         taskView.editing}">
                                <f:selectItem itemLabel="Sélectionnez&nbsp;une&nbsp;machine" itemValue=""/>
                                <f:selectItems value="#{taskView.entityPopup.idClient.workstationList}"/>
                                <f:converter binding="#{workstationConverter}"/>
                                <p:ajax update="taskViewForm:displayTworkstationDetails
                                        taskViewForm:tWorkstationViewForm"
                                        process="@this"
                                        oncomplete="$('taskViewForm\\\\:displayTworkstationDetails').css('display','inline');"
                                        listener="#{taskView.ajaxSelect}"/>
                                
                                <p:column>
                                    #{utils.getShortString(poste,20)}
                                </p:column>
                            </p:selectOneMenu>
                            
                            <p:commandButton id="displayTworkstationDetails"
                                             actionListener="#{workstationView.entityView(taskView.entityPopup.idWorkstation)}"
                                             icon="ui-icon-search"
                                             update="taskViewForm:tworkstationDetails"
                                             style="font-size: 40%;vertical-align: top !important;margin-left: 10px;"
                                             oncomplete="displayBlock('taskViewForm\\:tworkstationDetails');"
                                             action="javascript:void(0);"
                                             title="Afficher les détails du poste de travail"/>
                            
                        </p:outputPanel>

                        <h:outputLabel value="Utilisateur:" for="ptidUser"/>
                        <p:outputPanel>
                            <h:outputText id="ptidUserV" value="#{taskView.entityPopup.idUser}"
                                          title="Utilisateur pour l'intervention"
                                          rendered="#{not taskView.creating and
                                                      not taskView.editing}"/>
                            <p:selectOneMenu id="ptidUser"
                                             value="#{taskView.entityPopup.idUser}"
                                             effect="fade"
                                             var="cuser"
                                             rendered="#{taskView.creating or
                                                         taskView.editing}">
                                <f:selectItem itemLabel="Sélectionnez&nbsp;un&nbsp;utilisateur" itemValue=""/>
                                <f:selectItems value="#{taskView.entityPopup.idClient.CUserList}"/>
                                <f:converter binding="#{cUserConverter}"/>
                                <p:ajax update="taskViewForm:displayTcuserDetails
                                        taskViewForm:tCuserViewForm"
                                        process="@this"
                                        oncomplete="$('taskViewForm\\\\:displayTcuserDetails').css('display','inline');"
                                        listener="#{taskView.ajaxSelect}"/>
                                
                                <p:column>
                                    #{cuser}
                                </p:column>
                            </p:selectOneMenu>
                            
                            <p:commandButton id="displayTcuserDetails"
                                             actionListener="#{cUserView.entityView(taskView.entityPopup.idUser)}"
                                             icon="ui-icon-search"
                                             update="taskViewForm:tcuserDetails"
                                             style="font-size: 40%;vertical-align: top !important;margin-left: 10px;"
                                             oncomplete="displayBlock('taskViewForm\\:tcuserDetails');"
                                             action="javascript:void(0);"
                                             title="Afficher les détails de l'utilisateur"/>
                        </p:outputPanel>

                        <h:outputLabel value="Date de début:" for="ptstartDate"/>
                        <h:outputText id="ptstartDateV" value="#{taskView.entityPopup.startDate}"
                                      title="Date de début prévue de l'intervention"
                                      rendered="#{not taskView.creating and
                                                  not taskView.editing}">
                            <f:convertDateTime pattern="dd/MM/yyyy" />
                        </h:outputText>
                        <p:calendar id="ptstartDate" value="#{taskView.entityPopup.startDate}"
                                     title="Date de prévue pour l'intervention"
                                     disabledWeekends="false"
                                     effect="slideDown"
                                     locale="fr"
                                     mindate="#{taskView.entityPopup.startDate}"
                                     navigator="true"
                                     pattern="dd/MM/yyyy"
                                     showButtonPanel="true"
                                     widgetVar="startDateCalendar"
                                     rendered="#{taskView.creating or
                                                 taskView.editing}">
                            <script type="text/javascript">
                                $(document).ready(function(){loadLocales();});
                            </script>
                            <f:validator binding="#{notNullFieldValidator}"/>
                            <f:attribute name="requiredMessage"
                                         value="Veuillez entrer la date prévue pour l'intervention"/>
                            <f:attribute name="requiredTitle"
                                         value="Champs 'Date de l'intervention' vide"/>
                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                        </p:calendar>

                        <h:outputLabel value="Durée prévue:" for="ptintendedDuration"/>
                        <h:outputText id="ptintendedDurationV" value="#{taskView.entityPopup.intendedDuration}"
                                      title="Durée prévue pour l'intervention"
                                      rendered="#{not taskView.creating and
                                                  not taskView.editing}"/>
                        <p:calendar id="ptintendedDuration" value="#{taskView.entityPopup.intendedDuration}"
                                     title="Durée de prévue pour l'intervention"
                                     disabledWeekends="true"
                                     effect="slideDown"
                                     locale="fr"
                                     mindate="today"
                                     pattern="HH:mm"
                                     showButtonPanel="true"
                                     timeOnly="true"
                                     widgetVar="intendedDurationCalendar"
                                     rendered="#{taskView.creating or
                                                 taskView.editing}">
                            <f:converter binding="#{durationConverter}"/>
                        </p:calendar>

                        <h:outputLabel value="Déplacement:" for="ptdeplacement"/>
                        <h:outputText id="ptdeplacementV" value="#{taskView.entityPopup.deplacement?'Oui':'Non'}"
                                      title="#{taskView.entityPopup.deplacement?'Déplacement requis':'Déplacement non requis'}"
                                      rendered="#{not taskView.creating and
                                                  not taskView.editing}"/>
                        <p:selectBooleanButton id="ptdeplacement"
                                               offLabel="NON"
                                               onLabel="OUI"
                                               onIcon="ui-icon-check"
                                               offIcon="ui-icon-closethick"
                                               styleClass="yes_no_button"
                                               value="#{taskView.entityPopup.deplacement==null?false:
                                                        taskView.entityPopup.deplacement}"
                                               rendered="#{taskView.creating or
                                                           taskView.editing}">
                            <f:validator binding="#{notNullFieldValidator}"/>
                            <f:attribute name="requiredMessage"
                                         value="Veuillez indiquez si l'intervention requiert un déplacement"/>
                            <f:attribute name="requiredTitle"
                                         value="Champs 'Déplacement' invalide"/>
                        </p:selectBooleanButton>

                        <h:outputLabel value="Type d'intervention:" for="ptinterventionType"/>
                        <h:outputText id="ptinterventionTypeV" value="#{taskView.entityPopup.interventionType}"
                                      title="Type d'intervention"
                                      rendered="#{not taskView.creating and
                                                  not taskView.editing}"/>
                        <p:selectOneButton id="ptinterventionType"
                                           value="#{taskView.entityPopup.interventionType}"
                                           rendered="#{taskView.creating or
                                                       taskView.editing}">
                            <f:validator binding="#{notNullFieldValidator}"/>
                            <f:attribute name="requiredMessage"
                                         value="Veuillez indiquez le type d'intervention"/>
                            <f:attribute name="requiredTitle"
                                         value="Champs 'Type d'intervention' invalide"/>
                            <f:selectItems value="#{taskView.getInterventionTypes()}"/>
                        </p:selectOneButton>

                        <h:outputLabel value="Observations:" for="ptobservationsFull"/>
                        <h:inputTextarea id="ptobservationsFullV"
                                         value="#{taskView.entityPopup.observations.toString()}"
                                         title="Observations"
                                         readonly="true"
                                         styleClass="textarea_min"
                                         ondblclick="this.focus();this.select();"
                                         rendered="#{not taskView.creating and
                                                     not taskView.editing}">
                        </h:inputTextarea>
                        <h:inputTextarea id="ptobservationsFull"
                                         class="textarea_primefaces_display"
                                         rows="2"
                                         value="#{taskView.entityPopup.observations}"
                                         title="Observations"
                                         rendered="#{taskView.creating or
                                                     taskView.editing}">
                        </h:inputTextarea>

                        <h:outputLabel value="État:" for="ptstateV"
                                       rendered="#{not taskView.creating and
                                                   not taskView.editing}"/>
                        <h:outputText id="ptstateV" value="#{taskView.entityPopup.sleeping?'Faite':'À faire'}"
                                      title="#{taskView.entityPopup.sleeping?'La taâche est accomplie':'La tâche est à faire'}"
                                      rendered="#{not taskView.creating and
                                                  not taskView.editing}"/>

                        <f:facet name="footer">
                            <hr/>
                            <p:outputPanel styleClass="buttons_panel"
                                           rendered="#{not taskView.creating and
                                                       not taskView.editing}">
                                <p:commandButton title="Modifier cette tâche"
                                                 value="Modifier"
                                                 icon="ui-icon-wrench"
                                                 update=":taskViewForm :taskMenuDialogHeader"
                                                 action="javascript:void(0);"
                                                 actionListener="#{taskView.entityUpdate(taskView.entityPopup)}"/>
                                <p:commandButton title="Fermer la fenêtre"
                                                 action="javascript:void(0);"
                                                 icon="ui-icon-closethick"
                                                 styleClass="red_icon"
                                                 onclick="taskMenuViewDialog.hide();"
                                                 value="Fermer"/>
                            </p:outputPanel>
                            <p:outputPanel styleClass="buttons_panel"
                                           rendered="#{not taskView.creating and
                                                       taskView.editing}">
                                <p:commandButton id="ptupdateTaskButton"
                                                 action="javascript:void(0);"
                                                 actionListener="#{taskView.update()}"
                                                 title="Enresitrer les changements"
                                                 type="submit"
                                                 icon="ui-icon-disk"
                                                 styleClass="green_icon"
                                                 update=":taskViewForm :taskMenuDialogHeader :growl :taskMenuDataForm"
                                                 value="Modifier"
                                                 oncomplete="if(createRequestVoid(taskMenuViewDialog, xhr, status, args))
                                                        {forceUpdate('taskViewForm:ptupdateTaskButton','taskMenuDataForm');}
                                                        else{return false;}"/>
                                <p:commandButton id="ptbackUTaskButton"
                                                 title="Annuler la modification"
                                                 actionListener="#{taskView.cancelCreate()}"
                                                 value="Annuler"
                                                 immediate="true"
                                                 styleClass="red_icon"
                                                 update=":taskViewForm :taskMenuDialogHeader"
                                                 icon="ui-icon-closethick"
                                                 oncomplete="resetForm('taskViewForm');">
                                </p:commandButton>
                            </p:outputPanel>
                            <p:outputPanel styleClass="buttons_panel"
                                           rendered="#{taskView.creating and
                                                       not taskView.editing}">
                                <p:commandButton id="ptcreateTaskButton"
                                                 action="javascript:void(0);"
                                                 actionListener="#{taskView.create()}"
                                                 title="Créer cette tâche"
                                                 type="submit"
                                                 icon="ui-icon-check"
                                                 styleClass="green_icon"
                                                 update=":taskViewForm :taskMenuDialogHeader :growl :taskMenuDataForm"
                                                 value="Valider"
                                                 oncomplete="if(createRequest(taskMenuViewDialog, xhr, status, args))
                                                        {forceUpdate('taskViewForm:ptcreateTaskButton','taskMenuDataForm');}
                                                        else{return false;}"/>
                                <p:commandButton id="ptbackCTaskButton"
                                                 title="Annuler la création"
                                                 actionListener="#{taskView.cancelCreate()}"
                                                 value="Annuler"
                                                 immediate="true"
                                                 styleClass="red_icon"
                                                 update=":taskViewForm :taskMenuDialogHeader"
                                                 icon="ui-icon-closethick"
                                                 oncomplete="resetForm('taskViewForm');taskMenuViewDialog.hide();">
                                </p:commandButton>
                            </p:outputPanel>
                        </f:facet>

                    </h:panelGrid>
                </p:outputPanel>
                <p:outputPanel style="float:right;">
                    <p:outputPanel id="tclientDetails"
                                   styleClass="inside_dialog">
                        <p:commandButton icon="ui-icon-closethick"
                                         styleClass="red_icon"
                                         title="Chacher les information sur la société"
                                         onclick="hideBlock('taskViewForm\\:tclientDetails');"/>
                        <ui:include src="/restricted/admin/data/task/popups/clients.xhtml"/>
                    </p:outputPanel>
                    <p:outputPanel id="tworkstationDetails"
                                   styleClass="inside_dialog"
                                   style="display:none;">
                        <p:commandButton icon="ui-icon-closethick"
                                         styleClass="red_icon"
                                         title="Chacher les information sur le poste de travail"
                                         onclick="hideBlock('taskViewForm\\:tworkstationDetails');"/>
                        <ui:include src="/restricted/admin/data/task/popups/workstations.xhtml"/>
                    </p:outputPanel>
                    <p:outputPanel id="tcuserDetails"
                                   styleClass="inside_dialog"
                                   style="display:none;">
                        <p:commandButton icon="ui-icon-closethick"
                                         styleClass="red_icon"
                                         title="Chacher les information sur l'utilisateur"
                                         onclick="hideBlock('taskViewForm\\:tcuserDetails');"/>
                        <ui:include src="/restricted/admin/data/task/popups/cusers.xhtml"/>
                    </p:outputPanel>
                    <script type="text/javascript">
                        $(document).ready(function()
                        {
                            if(#{taskView.creating})
                            {
                                hideBlock('taskViewForm\\:displayTclientDetails');
                                hideBlock('taskViewForm\\:displayTworkstationDetails');
                                hideBlock('taskViewForm\\:displayTcuserDetails');
                            }
                            hideBlock('taskViewForm\\:tclientDetails');
                            addConcurrentBlock('taskViewForm\\:tclientDetails',
                                        ['taskViewForm\\:tworkstationDetails',
                                            'taskViewForm\\:tcuserDetails']);
                        });
                    </script>
                </p:outputPanel>
                <p:outputPanel rendered="#{empty taskView.entityPopup}">
                    <div class="ui-messages ui-widget">
                        <div class="ui-messages-error ui-corner-all">
                            <span class="ui-messages-error-icon"/>
                            <ul>
                                <li>
                                    <span class="ui-messages-error-summary">
                                        Sélection incorrecte!
                                        <script type="text/javascript">
//                                                    taskMenuViewDialog.hide();
                                        </script>
                                    </span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </p:outputPanel>
            </h:form>
        </f:view>

    </h:body>
</html>

