<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>Création tâche</title>
    </h:head>
    <h:body>
        <p:dialog id="createTaskPopup"
                  dynamic="true"
                  appendToBody="true"
                  header="Création d'une tâche"
                  widgetVar="createTaskDialog"
                  resizable="false"
                  draggable="true"
                  maximizable="false"
                  modal="true"
                  showEffect="clip"
                  hideEffect="clip">
            <p:ajax event="close" update="createTaskPopup"
                    process="@this"
                    listener="#{taskView.cancelCreate()}"/>
            <p:hotkey bind="esc" process="@this" handler="createTaskDialog.hide();"/>
            <h:form id="taskCreate">
                <script type="text/javascript">
                        $(document).ready(function()
                        {
                            addRedStarsToRequieredFields();
                        });
                </script>
                <p>
                    Veuillez renseigner les informations pour cette tâche.
                    <br />
                    (<span class="red-star">*</span>: champs requis)
                </p>
                <h:panelGrid columns="2" columnClasses="label,fields">

                    <p:outputLabel value="Société:"
                                   for="idClient"
                                   styleClass="requiered"/>
                    <p:selectOneMenu id="idClient"
                                     value="#{taskView.entityPopup.idClient}"
                                     effect="fade">
                        <f:validator binding="#{notNullFieldValidator}"/>
                        <f:attribute name="requieredMessage"
                                     value="Veuillez sélectionner la société dans laquelle intervenir"/>
                        <f:attribute name="requieredTitle"
                                     value="Champs 'Société' invalide"/>
                        <f:selectItem itemLabel="Sélectionnez&nbsp;une&nbsp;société" itemValue=""/>
                        <f:selectItems value="#{clientView.entries}"/>
                        <f:converter binding="#{clientConverter}"/>
                    </p:selectOneMenu>

                    <p:outputLabel value="Poste de travail:" for="idWorkstation" />
                    <p:selectOneMenu id="idWorkstation"
                                     value="#{taskView.entityPopup.idWorkstation}"
                                     effect="fade"
                                     style="width:90%;"
                                     var="poste">
                        <f:selectItem itemLabel="Sélectionnez&nbsp;une&nbsp;machine" itemValue=""/>
                        <f:selectItems value="#{workstationView.entries}"/>
                        <f:converter binding="#{workstationConverter}"/>
                        <p:column>  
                            #{utils.getBreakLinesString(utils.getShortString(poste,20))}  
                        </p:column>  
                    </p:selectOneMenu>

                    <p:outputLabel value="Utilisateur:" for="idUser" />
                    <p:selectOneMenu id="idUser"
                                     value="#{taskView.entityPopup.idUser}"
                                     effect="fade">
                        <f:selectItem itemLabel="Sélectionnez&nbsp;un&nbsp;utilisateur" itemValue=""/>
                        <f:selectItems value="#{cUserView.entries}"/>
                        <f:converter binding="#{cUserConverter}"/>
                    </p:selectOneMenu>

                    <p:outputLabel value="Description:"
                                   for="description"
                                   styleClass="requiered">
                    </p:outputLabel>
                    <p:inputText id="description"
                                 maxlength="250"
                                 value="#{taskView.entityPopup.description}"
                                 title="Description de l'intervention">
                        <f:validator binding="#{notNullFieldValidator}"/>
                        <f:attribute name="requieredMessage"
                                     value="Veuillez entrer une description de l'intervention"/>
                        <f:attribute name="requieredTitle"
                                     value="Champs 'Description' invalide"/>
                    </p:inputText>

                    <p:outputLabel value="Date de l'intervention:"
                                   for="startDate"
                                   styleClass="requiered"/>
                    <p:calendar id="startDate" value="#{taskView.entityPopup.startDate}"
                                 title="Date de prévue pour l'intervention"
                                 disabledWeekends="true"
                                 effect="slideDown"
                                 locale="fr"
                                 mindate="today"
                                 navigator="true"
                                 pattern="dd/MM/yyyy"
                                 showButtonPanel="true"
                                 widgetVar="startDateCalendar">
                        <f:validator binding="#{notNullFieldValidator}"/>
                        <f:attribute name="requieredMessage"
                                     value="Veuillez entrer la date prévue pour l'intervention"/>
                        <f:attribute name="requieredTitle"
                                     value="Champs 'Date de l'intervention' invalide"/>
                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                    </p:calendar>

                    <p:outputLabel value="Durée prévue:"
                                   for="intendedDuration"/>
                    <p:calendar id="intendedDuration" value="#{taskView.entityPopup.intendedDuration}"
                                 title="Durée de prévue pour l'intervention"
                                 disabledWeekends="true"
                                 effect="slideDown"
                                 locale="fr"
                                 mindate="today"
                                 pattern="HH:mm"
                                 showButtonPanel="true"
                                 timeOnly="true"
                                 widgetVar="intendedDurationCalendar">
                        <f:converter binding="#{durationConverter}"/>
                    </p:calendar>
                    
                    <p:outputLabel value="Déplacement:"
                                   for="deplacement"
                                   styleClass="requiered">
                    </p:outputLabel>
                    <p:selectBooleanButton id="deplacement"
                                           offLabel="NON"
                                           onLabel="OUI"
                                           onIcon="ui-icon-check"
                                           offIcon="ui-icon-closethick"
                                           styleClass="yes_no_button"
                                           value="#{taskView.entityPopup.deplacement==null?false:taskView.entityPopup.deplacement}">
                        <f:validator binding="#{notNullFieldValidator}"/>
                        <f:attribute name="requieredMessage"
                                     value="Veuillez indiquez si l'intervention requiert un déplacement"/>
                        <f:attribute name="requieredTitle"
                                     value="Champs 'Déplacement' invalide"/>
                    </p:selectBooleanButton>
                    
                    <p:outputLabel value="Type d'intervention:"
                                   for="interventionType"
                                   styleClass="requiered"/>
                    <p:selectOneButton id="interventionType"
                                       value="#{taskView.entityPopup.interventionType}">
                        <f:validator binding="#{notNullFieldValidator}"/>
                        <f:attribute name="requieredMessage"
                                     value="Veuillez indiquez le type d'intervention"/>
                        <f:attribute name="requieredTitle"
                                     value="Champs 'Type d'intervention' invalide"/>
                        <f:selectItems value="#{taskView.getInterventionTypes()}"/>
                    </p:selectOneButton>

                    <h:outputLabel value="Observations:" for="observations" />
                    <h:inputTextarea id="observations"
                                     class="textarea_primefaces_display"
                                     rows="2"
                                     value="#{taskView.entityPopup.observations}"
                                     title="Observations">
                    </h:inputTextarea>

                    <f:facet name="footer">
                        <p:outputPanel styleClass="buttons_panel"
                                       rendered="#{taskView.creating}">
                            <p:commandButton id="createTaskButton"
                                             action="javascript:void(0);"
                                             actionListener="#{taskView.create()}"
                                             value="Créer"
                                             type="submit"
                                             icon="ui-icon-check"
                                             styleClass="blue_icon"
                                             update=":taskCreate :growl :taskMenuDataForm"
                                             title="Créer cette tâche"
                                             oncomplete="if(createRequest(createTaskDialog, xhr, status, args)){forceFilter(taskMenuTable);}else{return false;}"/>
                            <p:commandButton id="backTaskButton"
                                             title="Annuler la création"
                                             action="javascript:void(0);"
                                             value="Annuler"
                                             styleClass="red_icon"
                                             type="reset"
                                             update=":taskCreate"
                                             icon="ui-icon-closethick"
                                             onclick="resetForm('taskCreate');createTaskDialog.hide();">
                            </p:commandButton>
                        </p:outputPanel>
                    </f:facet>
                </h:panelGrid>
            </h:form>
        </p:dialog>
    </h:body>
</html>

